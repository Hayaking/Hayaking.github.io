import{_ as n,V as s,W as a,Y as e}from"./framework.591e63b2.js";const p={},t=e(`<p>这里以同步mysql数据到clickhouse为例</p><blockquote><p>不支持同步mysql表结构变更到clickhouse</p></blockquote><h2 id="一、定义source" tabindex="-1"><a class="header-anchor" href="#一、定义source" aria-hidden="true">#</a> 一、定义source</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> source_blacklist <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span>          <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>type_id<span class="token punctuation">\`</span></span>     <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>value<span class="token punctuation">\`</span></span>       STRING<span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>comment<span class="token punctuation">\`</span></span>     STRING<span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>create_time<span class="token punctuation">\`</span></span> <span class="token keyword">Timestamp</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>update_time<span class="token punctuation">\`</span></span> <span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>deleted<span class="token punctuation">\`</span></span>     <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span>       <span class="token keyword">KEY</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span> <span class="token operator">NOT</span> ENFORCED
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
     <span class="token string">&#39;connector&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;mysql-cdc&#39;</span><span class="token punctuation">,</span>
     <span class="token string">&#39;hostname&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;x.x.x.x&#39;</span><span class="token punctuation">,</span>
     <span class="token string">&#39;port&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;30005&#39;</span><span class="token punctuation">,</span>
     <span class="token string">&#39;username&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span>
     <span class="token string">&#39;password&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span>
     <span class="token string">&#39;database-name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span>
     <span class="token string">&#39;table-name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;blacklist&#39;</span><span class="token punctuation">,</span>
     <span class="token string">&#39;jdbc.properties.useSSL&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;false&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="二、定义sink" tabindex="-1"><a class="header-anchor" href="#二、定义sink" aria-hidden="true">#</a> 二、定义sink</h2><p>这里使用了clickhouse-connector</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> sink_blacklist <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span>          <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>type_id<span class="token punctuation">\`</span></span>     <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>value<span class="token punctuation">\`</span></span>       STRING<span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>comment<span class="token punctuation">\`</span></span>     STRING<span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>create_time<span class="token punctuation">\`</span></span> <span class="token keyword">Timestamp</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>update_time<span class="token punctuation">\`</span></span> <span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>deleted<span class="token punctuation">\`</span></span>     <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span>       <span class="token keyword">KEY</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span> <span class="token operator">NOT</span> ENFORCED
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
    <span class="token string">&#39;connector&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;clickhouse&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;url&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;x.x.x.x&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;username&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;password&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;database-name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;table-name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;blacklist&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;sink.batch-size&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;500&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;sink.flush-interval&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;1000&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;sink.max-retries&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;3&#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三、insert-into" tabindex="-1"><a class="header-anchor" href="#三、insert-into" aria-hidden="true">#</a> 三、insert into</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token string">&#39;pipeline.name&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;xxx&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token string">&#39;table.local-time-zone&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;Asia/Shanghai&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token string">&#39;state.checkpoints.dir&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;file:///flink-data/cp/xxx&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token string">&#39;execution.checkpointing.mode&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;EXACTLY_ONCE&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token string">&#39;execution.checkpointing.interval&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;1min&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token string">&#39;execution.checkpointing.prefer-checkpoint-for-recovery&#39;</span> <span class="token operator">=</span> <span class="token string">&#39;true&#39;</span><span class="token punctuation">;</span>
<span class="token comment">--</span>

<span class="token keyword">EXECUTE</span> STATEMENT <span class="token keyword">SET</span>
<span class="token keyword">BEGIN</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> sink_blacklist <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> source_blacklist<span class="token punctuation">;</span>

<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),o=[t];function c(i,l){return s(),a("div",null,o)}const r=n(p,[["render",c],["__file","flink sql cdc.html.vue"]]);export{r as default};
