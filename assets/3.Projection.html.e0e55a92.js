import{_ as n,V as s,W as a,Y as e}from"./framework.591e63b2.js";const t={},o=e(`<h2 id="什么是projection" tabindex="-1"><a class="header-anchor" href="#什么是projection" aria-hidden="true">#</a> 什么是Projection</h2><p>投影Projection，Clickhouse通过投影语句，聚合数据</p><p>当查询时，聚合条件或排序条件与投影语句相同时，就会命中查询已经聚合好的数据，减少了现查现算的步骤，能够明显加快查询速度</p><h2 id="创建projection" tabindex="-1"><a class="header-anchor" href="#创建projection" aria-hidden="true">#</a> 创建projection</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 修改现有的表</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名
<span class="token keyword">ADD</span> PROJECTION 名字<span class="token punctuation">(</span>
    投影<span class="token keyword">sql</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建表时 projection</span>
<span class="token keyword">create</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名<span class="token punctuation">(</span>
    <span class="token comment">---...声明表的字段,</span>
    PROJECTION 名字<span class="token punctuation">(</span>
        投影<span class="token keyword">sql</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="物化历史数据" tabindex="-1"><a class="header-anchor" href="#物化历史数据" aria-hidden="true">#</a> 物化历史数据</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名 MATERIALIZE PROJECTION 名字<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="删除projection" tabindex="-1"><a class="header-anchor" href="#删除projection" aria-hidden="true">#</a> 删除projection</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名 <span class="token keyword">DROP</span> PROJECTION 名字<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="清空projection的数据" tabindex="-1"><a class="header-anchor" href="#清空projection的数据" aria-hidden="true">#</a> 清空projection的数据</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名 CLEAR PROJECTION 名字 <span class="token punctuation">[</span><span class="token operator">IN</span> <span class="token keyword">PARTITION</span> 分区名<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="开启projection" tabindex="-1"><a class="header-anchor" href="#开启projection" aria-hidden="true">#</a> 开启Projection</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> allow_experimental_projection_optimization<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="判断是否命中projection" tabindex="-1"><a class="header-anchor" href="#判断是否命中projection" aria-hidden="true">#</a> 判断是否命中Projection</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 强制走projection，如果没有合适的projection，会抛异常</span>
settings force_optimize_projection<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="用途" tabindex="-1"><a class="header-anchor" href="#用途" aria-hidden="true">#</a> 用途</h2><h3 id="使用projection加速聚合查询" tabindex="-1"><a class="header-anchor" href="#使用projection加速聚合查询" aria-hidden="true">#</a> 使用Projection加速聚合查询</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名
<span class="token keyword">ADD</span> PROJECTION 名字<span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 物化历史数据</span>
<span class="token keyword">alter</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名 MATERIALIZE PROJECTION 名字<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="将projection当做二级索引使用" tabindex="-1"><a class="header-anchor" href="#将projection当做二级索引使用" aria-hidden="true">#</a> 将Projection当做二级索引使用</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 使用重排序后的原始数据创建Projection</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名
<span class="token keyword">ADD</span> PROJECTION 名字
<span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 物化历史数据</span>
<span class="token keyword">alter</span> <span class="token keyword">TABLE</span> 库名<span class="token punctuation">.</span>表名 MATERIALIZE PROJECTION 名字<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,20),i=[o];function c(p,l){return s(),a("div",null,i)}const r=n(t,[["render",c],["__file","3.Projection.html.vue"]]);export{r as default};
